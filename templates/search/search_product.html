{% extends "base.html" %}
{% load static %}
{% block title %}Search Product - Blue Sky Summer{% endblock %}

{% block content %}

<div class="search-wrapper">

    <h1 class="search-title">Search Results</h1>
    <img src="{% static 'image/separator-img.png' %}" class="search-separator" width="180">

    <!-- PRODUCT GRID ONLY FOR PRODUCTS -->
    <div class="product-grid">
        {% if products %}
            {% for product in products %}

            <form action="{% url 'add_to_cart' product.id %}"
                  method="post"
                  class="product-card">
                {% csrf_token %}

                <!-- STOCK BADGE -->
                {% if product.product_stock > 9 %}
                    <span class="stock-badge stock-green">In Stock</span>
                {% elif product.product_stock == 0 %}
                    <span class="stock-badge stock-red">Out of Stock</span>
                {% else %}
                    <span class="stock-badge stock-red">Only {{ product.product_stock }} left!</span>
                {% endif %}

                <!-- PRODUCT IMAGE -->
                <img src="{{ product.product_image.url }}" class="main-img" alt="{{ product.product_name }}">

                <!-- CARD BODY -->
                <div class="card-body">
                    <div class="product-name">{{ product.product_name }}</div>
                    <div class="product-price">â‚¹{{ product.product_price }}</div>

                    <!-- ACTION ICONS -->
                    <div class="action-icons">
                        <button type="submit"><i class="bx bx-cart"></i></button>

                        <button type="submit"
                                formaction="{% url 'add_to_wishlist' product.id %}">
                            <i class="bx bx-heart"></i>
                        </button>

                        <a href="{% url 'view_product' product.id %}">
                            <i class="bx bxs-show"></i>
                        </a>
                    </div>

                    <input type="hidden" name="product_id" value="{{ product.id }}">

                    <!-- BUY NOW + QTY -->
                    <div class="buy-section">
                        <a href="{% url 'checkout' %}?get_id={{ product.id }}" class="buy-btn">Buy Now</a>

                        <input type="number"
                               name="qty"
                               min="1"
                               max="99"
                               value="1"
                               class="qty-input">
                    </div>
                </div>
            </form>

            {% endfor %}
        {% endif %}
    </div>

    <!-- EMPTY STATE OUTSIDE GRID -->
    {% if not products %}
    <div class="empty-wrapper">
        <div class="empty-center">
            <img src="{% static 'image/icon/empty.png' %}"
                 alt="No Products"
                 class="empty-center-img">

            <h2>No Products Found</h2>
            <p>Try adjusting your search terms and search again.</p>
        </div>
    </div>
    {% endif %}

</div>


<style>

/* MAIN WRAPPER */
.search-wrapper {
    width: 90%;
    margin: 2rem auto;
    text-align: center;
}

.search-title {
    font-size: 2rem;
    color: #333;
    margin-bottom: .5rem;
}

/* GRID */
.product-grid {
    margin-top: 2rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 2rem;
}

/* CARD */
.product-card {
    background: #fff;
    border-radius: 12px;
    padding-bottom: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: .2s ease;
    position: relative;
    overflow: hidden;
}

.product-card:hover {
    transform: translateY(-5px);
}

/* PRODUCT IMAGE */
.main-img {
    width: 100%;
    height: 190px;
    object-fit: cover;
    border-bottom: 1px solid #eee;
}

/* STOCK BADGES */
.stock-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 4px 10px;
    font-size: 13px;
    border-radius: 6px;
    color: #fff;
}

.stock-green { background: #28a745; }
.stock-red { background: #e74c3c; }

/* DETAILS */
.card-body {
    padding: 1rem;
    text-align: left;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: .3rem;
    color: #333;
}

.product-price {
    font-size: 1rem;
    color: #14b8a6;
    font-weight: 600;
    margin-bottom: .8rem;
}

/* ICON ACTIONS */
.action-icons {
    display: flex;
    align-items: center;
    gap: .7rem;
    margin-bottom: 1rem;
}

.action-icons button,
.action-icons a {
    background: #f5f6fa;
    border: none;
    padding: .5rem .6rem;
    border-radius: 6px;
    cursor: pointer;
    transition: .2s;
}

.action-icons button:hover,
.action-icons a:hover {
    background: #14b8a6;
    color: #fff;
}

.action-icons i {
    font-size: 1.2rem;
    color: #333;
}

/* BUY SECTION */
.buy-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.buy-btn {
    background: #14b8a6;
    color: white;
    padding: .5rem 1rem;
    border-radius: 6px;
    transition: .2s;
}

.buy-btn:hover {
    background: #11998e;
}

.qty-input {
    width: 55px;
    padding: .4rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    text-align: center;
}

/* EMPTY FULL PAGE CENTER */
.empty-wrapper {
    width: 100%;
    height: 60vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.empty-center {
    text-align: center;
}

.empty-center-img {
    width: 180px;
    opacity: 0.95;
    margin-bottom: 1rem;
}

.empty-center h2 {
    font-size: 2rem;
    font-weight: 600;
    color: #333;
}

.empty-center p {
    font-size: 1.1rem;
    color: #666;
}

</style>

{% endblock %}
